<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappa Medici Arezzo e Provincia</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: #f4f4f9; }
        header { background-color: #007bff; color: white; padding: 20px; text-align: center; }
        
        .container { display: flex; flex-wrap: wrap; height: calc(100vh - 80px); }
        
        /* Colonna Elenco (Sinistra) */
        .list-panel {
            width: 350px;
            background: white;
            overflow-y: auto;
            border-right: 1px solid #ddd;
            padding: 10px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        
        /* Colonna Mappa (Destra) */
        .map-panel { flex-grow: 1; position: relative; }
        #map { width: 100%; height: 100%; background-color: #e5e3df; } /* Colore di sfondo se la mappa non carica */

        .medico-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: transform 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .medico-card:hover { transform: translateY(-2px); border-color: #007bff; }
        .medico-name { font-weight: bold; color: #333; font-size: 1.1em; }
        .medico-info { color: #666; font-size: 0.9em; margin: 5px 0; }
        .btn-google {
            display: inline-block;
            margin-top: 8px;
            padding: 6px 12px;
            background-color: #34a853; /* Verde Google */
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .btn-google:hover { background-color: #2c8e45; }

        /* Avviso se manca internet */
        .offline-alert {
            position: absolute; top: 10px; right: 10px; z-index: 999;
            background: rgba(255,0,0,0.8); color: white; padding: 10px;
            border-radius: 5px; display: none;
        }

        /* Responsive per cellulari */
        @media (max-width: 768px) {
            .container { flex-direction: column-reverse; height: auto; }
            .list-panel { width: 100%; height: 50vh; }
            .map-panel { height: 50vh; }
        }
    </style>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

<header>
    <h2>Medici Medicina Generale - ASL Toscana Sud Est</h2>
    <small>Basato su doc. "Assegnazione nuove AAFFTT" (Dati aggiornati 2026)</small>
</header>

<div class="container">
    <div class="list-panel" id="lista-medici">
        <p style="text-align:center; color:#888;">Clicca "Vedi su Google Maps" se la mappa non carica.</p>
        </div>

    <div class="map-panel">
        <div id="map"></div>
        <div id="offline-alert" class="offline-alert">‚ö†Ô∏è Impossibile caricare la mappa. Controlla la connessione.</div>
    </div>
</div>

<script>
    // --- DATI ESTRATTI DAL PDF (Pagine 5, 6, 7) ---
    // Coordinate dei centri AFT (Poich√© il PDF non ha indirizzi precisi)
    
    const locations = [
        // AREZZO CITTA' (AFT 1, 2, 3)
        { nome: "APPIANO GIANNICOLA", aft: "Arezzo Centro", coords: [43.4631, 11.8781] },
        { nome: "FRUSCOLONI GIORGIO", aft: "Arezzo Centro", coords: [43.4650, 11.8700] },
        { nome: "MAURIZI GIORGIA", aft: "Arezzo Centro Sud", coords: [43.4500, 11.8800] },
        { nome: "MORI SUSANNA", aft: "Arezzo Centro Sud", coords: [43.4500, 11.8800] },
        
        // VALDARNO (AFT 7, 8, 9)
        { nome: "SALATINO ALICE", aft: "San Giovanni Valdarno / Cavriglia", coords: [43.5645, 11.5303] },
        { nome: "BERNINI STEFANIA", aft: "Terranuova B. / Loro Ciuffenna", coords: [43.5519, 11.5855] },
        { nome: "PALAZZO LUDOVICA", aft: "Montevarchi", coords: [43.5236, 11.5678] },
        
        // CASENTINO (AFT 6)
        { nome: "FINI MARTINA", aft: "Bibbiena / Casentino", coords: [43.6967, 11.8153] },
        { nome: "GAMBINERI STEFANO", aft: "Bibbiena / Casentino", coords: [43.6967, 11.8153] },
        
        // VALDICHIANA (AFT 5, 11, 12)
        { nome: "NASSINI EDOARDO", aft: "Civitella / Monte San Savino", coords: [43.3333, 11.7250] },
        { nome: "FRANCESCHINI EDOARDO", aft: "Cortona", coords: [43.2753, 11.9856] },
        { nome: "AGNELLI FABRIZIO", aft: "Castiglion F.no / Foiano", coords: [43.3433, 11.9288] },
        
        // VALTIBERINA (AFT 13)
        { nome: "MARIANI GIULIANA", aft: "Sansepolcro / Valtiberina", coords: [43.5714, 12.1394] },
        { nome: "TORRE GIORGIO", aft: "Sansepolcro / Valtiberina", coords: [43.5714, 12.1394] }
    ];

    // Inizializzazione Mappa
    var map;
    try {
        map = L.map('map').setView([43.4631, 11.8781], 10);
        
        // Layer OpenStreetMap (Gratuito)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Controllo caricamento tile (se fallisce, mostra alert)
        map.on('tileerror', function() {
            document.getElementById('offline-alert').style.display = 'block';
        });

    } catch (e) {
        document.getElementById('map').innerHTML = '<div style="padding:20px; text-align:center;"><h3>Errore caricamento mappa interattiva</h3><p>Usa i link a sinistra per aprire Google Maps.</p></div>';
    }

    // Generazione Lista e Marker
    const listContainer = document.getElementById('lista-medici');

    locations.forEach(medico => {
        // 1. Aggiungi Marker sulla Mappa
        if(map) {
            // Piccolo "jitter" casuale per non sovrapporre i punti identici
            let lat = medico.coords[0] + (Math.random() - 0.5) * 0.005;
            let lng = medico.coords[1] + (Math.random() - 0.5) * 0.005;
            
            L.marker([lat, lng])
                .addTo(map)
                .bindPopup(`<b>${medico.nome}</b><br>${medico.aft}`);
        }

        // 2. Crea Link Google Maps Dinamico
        // Formato link: https://www.google.com/maps/search/?api=1&query=lat,lng
        let gmapsLink = `https://www.google.com/maps/search/?api=1&query=${medico.coords[0]},${medico.coords[1]}`;

        // 3. Aggiungi Scheda nella Colonna Laterale
        let card = document.createElement('div');
        card.className = 'medico-card';
        card.innerHTML = `
            <div class="medico-name">${medico.nome}</div>
            <div class="medico-info">Zona: ${medico.aft}</div>
            <a href="${gmapsLink}" target="_blank" class="btn-google">üìç Vedi su Google Maps</a>
        `;
        listContainer.appendChild(card);
    });

</script>

</body>
</html>
